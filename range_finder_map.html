<!DOCTYPE html>
<html>
<head>
  <title>Range Finder Map</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #map { height: 500px; }
    body { font-family: Arial, sans-serif; }
    .controls { margin-top: 10px; }
    label { margin-right: 10px; }
    #progress { margin-top: 10px; font-weight: bold; }
  </style>
</head>
<body>
  <h2>Range Finder Map</h2>
  <div id="map"></div>
  <div class="controls">
    <label>Latitude: <input type="number" id="lat" value="38.573315" step="any"></label>
    <label>Longitude: <input type="number" id="lon" value="-109.549839" step="any"></label>
    <label>Bearing (degrees): <input type="number" id="bearing" value="90" step="any" readonly></label>
    <label>Distance (miles): <input type="number" id="distance" value="1000"></label>
    <button onclick="drawLine()">Draw Line</button>
  </div>
  <div id="progress"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const R = 6371;
    const MILES_TO_KM = 1.60934;
    const EARTH_CIRCUMFERENCE_MILES = 24901;

    function toRad(deg) { return deg * Math.PI / 180; }
    function toDeg(rad) { return rad * 180 / Math.PI; }

    function destinationPoint(lat, lon, bearing, distanceKm) {
      let angularDistance = distanceKm / R;
      let brng = toRad(bearing);
      let lat1 = toRad(lat);
      let lon1 = toRad(lon);

      let lat2 = Math.asin(Math.sin(lat1) * Math.cos(angularDistance) +
                           Math.cos(lat1) * Math.sin(angularDistance) * Math.cos(brng));
      let lon2 = lon1 + Math.atan2(Math.sin(brng) * Math.sin(angularDistance) * Math.cos(lat1),
                                   Math.cos(angularDistance) - Math.sin(lat1) * Math.sin(lat2));

      return [toDeg(lat2), toDeg(lon2)];
    }

    const map = L.map('map').setView([38.573315, -109.549839], 4);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    let currentLine;

    function drawLine() {
      let lat = parseFloat(document.getElementById('lat').value);
      let lon = parseFloat(document.getElementById('lon').value);
      let bearing = 90;
      let distanceMiles = parseFloat(document.getElementById('distance').value);
      let distanceKm = distanceMiles * MILES_TO_KM;

      const [destLat, destLon] = destinationPoint(lat, lon, bearing, distanceKm);

      if (currentLine) map.removeLayer(currentLine);
      currentLine = L.polyline([[lat, lon], [destLat, destLon]], {color: 'blue'}).addTo(map);
      map.fitBounds([[lat, lon], [destLat, destLon]]);

      const percent = Math.min((distanceMiles / EARTH_CIRCUMFERENCE_MILES) * 100, 100).toFixed(2);
      document.getElementById("progress").textContent = `You've traveled ${distanceMiles.toLocaleString()} miles â€” that's ${percent}% of the way around the Earth!`;
    }

    window.onload = function () {
      if (window.autoDistance) {
        document.getElementById("distance").value = window.autoDistance;
        drawLine();
      }
    };
  </script>
</body>
</html>

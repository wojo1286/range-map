
<!DOCTYPE html>
<html>
<head>
  <title>Range Finder Map</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    #map {{
      height: 90vh;
      width: 100%;
    }}
    body {{
      font-family: Arial, sans-serif;
    }}
    input {{
      margin: 5px;
    }}
  </style>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-geometryutil"></script>
</head>
<body>
  <h2>Range Finder Map</h2>
  <div id="map"></div>
  <div>
    Latitude: <input type="number" id="lat" step="any" value="38.573315" />
    Longitude: <input type="number" id="lng" step="any" value="-109.549839" />
    Bearing (degrees): <input type="number" id="bearing" value="90" />
    Distance (miles): <input type="number" id="distance" step="any" value="1000" />
    <button onclick="drawLine()">Draw Line</button>
  </div>
  <p id="summary"></p>

  <script>
    const EARTH_CIRCUMFERENCE_MILES = 24901;
    const map = L.map('map', {{
      worldCopyJump: false,
      maxBoundsViscosity: 1.0,
      maxZoom: 10,
      minZoom: 2
    }}).setView([38.573315, -109.549839], 3);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {{
      maxZoom: 18,
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }}).addTo(map);

    let polyline;

    function drawLine() {{
      const lat = parseFloat(document.getElementById("lat").value);
      const lng = parseFloat(document.getElementById("lng").value);
      const bearing = parseFloat(document.getElementById("bearing").value);
      const distanceMiles = parseFloat(document.getElementById("distance").value);
      const distanceKm = distanceMiles * 1.60934;

      const latlng = L.latLng(lat, lng);
      const dest = L.GeometryUtil.destination(latlng, bearing, distanceKm * 1000);

      if (polyline) {{
        map.removeLayer(polyline);
      }}
      polyline = L.polyline([latlng, dest], {{color: 'blue'}}).addTo(map);
      map.fitBounds(polyline.getBounds(), {{padding: [50, 50]}});

      const percent = ((distanceMiles / EARTH_CIRCUMFERENCE_MILES) * 100).toFixed(2);
      document.getElementById("summary").innerHTML = 
        `<strong>You've traveled ${distanceMiles.toLocaleString()} miles</strong> â€” that's <strong>${percent}%</strong> of the way around the Earth!`;
    }}

    // Allow setting distance via URL
    function getQueryParam(param) {{
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }}

    window.onload = () => {{
      const distanceFromURL = getQueryParam("distance");
      if (distanceFromURL) {{
        document.getElementById("distance").value = distanceFromURL;
        drawLine();
      }}
    }};
  </script>
</body>
</html>
